{% comment %}
  Loads a user's data.
  Params:
    - id: string
      the user's id
    - current: boolean
      load the user from context
{% endcomment %}
{% liquid
  assign user_id = id

  # Set current flag.
  if id and id == context.current_user.id
    assign current = true
  endif

  if current
    assign user_id = context.current_user.id
  endif

  if user_id != blank
    graphql users = 'modules/user/user/load', id: user_id
    assign user = users.users.results.first
  endif

  if user
    function user_roles = 'modules/user/lib/queries/user_roles/get', user_id: user.id
    assign user_roles = user_roles.roles | default: '[]' | parse_json
    if current
      assign user_roles = user_roles | add_to_array: 'authenticated'
    endif
    hash_assign user['roles'] = user_roles
  else
    assign user = '{"roles": []}' | parse_json
    if current
      assign user_roles = 'anonymous' | split: ','
      hash_assign user['roles'] = user_roles
    endif
  endif

  function permissions = 'modules/user/lib/queries/user/get_permissions', user: user
  hash_assign user['permissions'] = permissions


  assign params = '{}' | parse_json | hash_merge: user: user
  function results = 'modules/core/lib/commands/hook/fire', hook: 'user_load', params: params, merge_to_object: true
  hash_assign user['hook_results'] = results

  assign params_to_modify = '{}' | parse_json | hash_merge: user: user
  assign params = '{}' | parse_json | hash_merge: user: user
  function _ = 'modules/core/lib/commands/hook/alter', hook: 'user_load', params_to_modify: params_to_modify, params: params

  return user
%}
