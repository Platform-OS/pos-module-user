{% comment %}
  Creates a user sessions.
  Params:
    - email: string
      the user's email address
    - password: string
      the user's password
    - hook_params: object
      the other params that will be passed to hook_user_login
{% endcomment %}
{% liquid
  function user = 'modules/user/lib/commands/user/verify_password', email: email, password: password

  if user.authenticate.valid
    function user = 'modules/user/lib/queries/user/load', id: user.id
    sign_in_rc user_id: user.id
    assign params = '{}' | parse_json | hash_merge: user: user.user, hook_params: hook_params
    function results = 'modules/core/lib/commands/hook/fire', hook: 'user_login', params: params, merge_to_object: true
    hash_assign user['hook_results'] = results
  endif

  return user
%}
