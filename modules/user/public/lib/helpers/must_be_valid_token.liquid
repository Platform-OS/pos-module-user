{% liquid
  if token == blank or email == blank
    function _ = 'modules/user/helpers/flash', error: 'app.errors.unauthenticated'
    redirect_to '/sessions/new'
  endif

  function user = 'modules/user/queries/user/find', email: email
  assign authenticated = token | is_token_valid: user.id
  if authenticated
    session reset_password_session_user_id = user.id

    redirect_to '/passwords/new'
  else
    function _ = 'modules/user/helpers/flash', error: 'app.account.reset_password.expired_link'
    redirect_to '/sessions/new'
  endif
%}
