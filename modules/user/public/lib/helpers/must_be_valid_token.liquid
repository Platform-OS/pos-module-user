{% liquid
  if token == blank or email == blank
    function _ = 'modules/user/helpers/flash', error: 'modules/user/errors.unauthenticated'
    redirect_to '/sessions/new'
  endif

  function user = 'modules/user/queries/user/find', email: email
  if user
    assign authenticated = token | is_token_valid: user.id
  endif
  if user and authenticated
    session reset_password_session_user_id = user.id

    redirect_to '/passwords/new'
  else
    function _ = 'modules/user/helpers/flash', error: 'modules/user/account.reset_password.expired_link'
    redirect_to '/sessions/new'
  endif
%}
