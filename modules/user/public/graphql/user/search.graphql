query (
  $id: ID
  $not_ids: [ID!]
  $email: String
  $limit: Int = 20
  $page: Int = 1
  $sort: UsersSortInput = { id: { order: DESC } }
  $include_profiles: Boolean = false
) {
  users(
    per_page: $limit
    page: $page
    filter: {
      id: { value: $id, not_value_in: $not_ids }
      email: { value: $email }
    }
    sort: [$sort]
  ) {
    results {
      id
      email
      created_at
      roles: property_array(name: "roles")
      profiles: related_records(
        table: "modules/user/profile"
        join_on_property: "id"
        foreign_property: "user_id"
        limit: 1
      ) @include(if: $include_profiles) {
        id
        email: property(name: "email")
        first_name: property(name: "first_name")
        last_name: property(name: "last_name")
        name: property(name: "name")
        user_id: property(name: "user_id")
        uuid: property(name: "uuid")
        roles: property_array(name: "roles")
      }
    }
  }
}
