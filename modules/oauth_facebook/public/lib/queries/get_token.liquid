{% liquid
  assign query = "{}" | parse_json
  hash_assign query["code"] = data.code
  hash_assign query["client_id"] = data.client_id
  hash_assign query["client_secret"] = data.client_secret
  assign location = "https://" | append: context.location.host | append: '/oauth/facebook/callback'
  hash_assign query["redirect_uri"] = location
  assign query = query | querify

  assign headers = "{}" | parse_json
  hash_assign headers["Accept"] = "application/json"

  assign url = "https://graph.facebook.com/v22.0/oauth/access_token?" | append: query
  graphql r  = "modules/oauth_facebook/get_token", body: url, headers: headers
  assign result = r.api_call_send.response.body | parse_json
  return result
%}
  